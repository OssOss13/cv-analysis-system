{% extends 'positions/base.html' %}

{% block title %}{{ position.title }} - CV Analysis System{% endblock %}

{% block content %}
<div style="margin-bottom: 20px;">
    <a href="{% url 'position_list' %}" style="color: #777; text-decoration: none;">&larr; Back to Positions</a>
</div>

<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
    <div>
        <h1 style="margin-bottom: 10px; border-bottom: none;">{{ position.title }}</h1>
        <div class="meta-info" style="font-size: 1.1em;">
            <span class="badge badge-{{ position.seniority|lower }}">{{ position.seniority }}</span>
            <span style="margin-left: 15px;">üìç {{ position.location }}</span>
            <span style="margin-left: 15px;">üíº {{ position.employment_type }}</span>
            {% if position.is_remote %}
            <span style="margin-left: 15px;">üè† Remote</span>
            {% endif %}
            {% if position.salary_range %}
            <span style="margin-left: 15px;">üí∞ {{ position.salary_range }}</span>
            {% endif %}
        </div>
    </div>

    <div style="display: flex; gap: 10px;">
        {% if user.is_staff %}
        <a href="{% url 'position_update' position.pk %}">
            <button class="btn-warning">Edit</button>
        </a>
        <a href="{% url 'position_delete' position.pk %}">
            <button class="btn-danger">Delete</button>
        </a>
        {% endif %}

        {% if user.is_authenticated %}
        {% if not user.is_staff %}
        <a href="{% url 'apply_for_position' position.pk %}">
            <button class="btn-primary" style="padding: 10px 30px; font-size: 1.1em;">Apply Now</button>
        </a>
        {% endif %}
        {% else %}
        <a href="{% url 'login' %}?next={{ request.path }}">
            <button class="btn-primary" style="padding: 10px 30px; font-size: 1.1em;">Login to Apply</button>
        </a>
        {% endif %}
    </div>
</div>

<div style="background: #fff; padding: 30px; border-radius: 8px; border: 1px solid #eee;">
    <h2>Description</h2>
    <div style="line-height: 1.6; color: #444; white-space: pre-line;">{{ position.description }}</div>

    {% if position.responsibilities %}
    <h2>Responsibilities</h2>
    <div style="line-height: 1.6; color: #444; white-space: pre-line;">{{ position.responsibilities }}</div>
    {% endif %}

    {% if position.skills_needed %}
    <h2>Skills Needed</h2>
    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
        {% for skill in position.get_skills %}
        <span style="background: #e8f5e9; color: #2e7d32; padding: 5px 15px; border-radius: 20px; font-size: 0.9em;">
            {{ skill }}
        </span>
        {% endfor %}
    </div>
    {% endif %}

    {% if position.benefits %}
    <h2>Benefits</h2>
    <div style="line-height: 1.6; color: #444; white-space: pre-line;">{{ position.benefits }}</div>
    {% endif %}

    <div style="margin-top: 40px; border-top: 1px solid #eee; padding-top: 20px; color: #777; font-size: 0.9em;">
        Posted on {{ position.created_at|date:"F d, Y" }}
        {% if position.closing_date %}
        <br>Applications close on {{ position.closing_date|date:"F d, Y" }}
        {% endif %}
    </div>
</div>

{% if user.is_staff and applications %}
<div style="margin-top: 30px; background: #fff; padding: 30px; border-radius: 8px; border: 1px solid #eee;">
    <h2>Applications ({{ applications.count }})</h2>
    <table>
        <thead>
            <tr>
                <th>Candidate</th>
                <th>Applied At</th>
                <th>Match Score</th>
                <th>Status</th>
                <th>CV</th>
            </tr>
        </thead>
        <tbody>
            {% for app in applications %}
            <tr>
                <td>{{ app.cv.uploaded_by.username|default:"Unknown" }}</td>
                <td>{{ app.applied_at|date:"M d, Y H:i" }}</td>
                <td>
                    {% if app.match_score %}
                    {{ app.match_score|floatformat:1 }}%
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td><span class="badge badge-{{ app.status|lower }}">{{ app.status }}</span></td>
                <td>
                    <a href="{% url 'view_cv' app.cv.id %}" target="_blank" class="btn btn-secondary"
                        style="padding: 5px 10px; font-size: 0.9em;">View CV</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" style="text-align: center; color: #777;">No applications yet.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

{% endblock %}